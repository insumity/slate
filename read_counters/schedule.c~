#define _GNU_SOURCE
#include <stdio.h>
#include <dirent.h>
#include <string.h>
#include <assert.h>
#include <pthread.h>
#include <stdlib.h>
#include <stdbool.h>
#include <errno.h>
#include <unistd.h>
#include <sched.h>
#include <mctop.h>
#include <mctop_alloc.h>
#include <sys/wait.h>
#include <time.h>
#include <numaif.h>
#include <sys/mman.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <semaphore.h>
#include <time.h>
#include <numaif.h>
#include <papi.h>
#include <linux/perf_event.h>
#include <linux/hw_breakpoint.h>


#define SLEEPING_TIME_IN_MICROSECONDS 5000
#define SLOTS_FILE_NAME "/tmp/scheduler_slots"
#define NUM_SLOTS 10


  //  uint64_t INSTRUCTIONS = 0x00C0;
  //uint64_t CYCLES = 0x003C; // those are halted cycles as well
  uint64_t CACHE_LLC_HITS = 0x4F2E;
  uint64_t CACHE_LLC_MISSES = 0x412E; 
  uint64_t RETIRED_LOCAL_DRAM = 0x01D3; // MEM_LOAD_UOPS_LLC_MISS_RETIRED.LOCAL_DRAM
  uint64_t RETIRED_REMOTE_DRAM = 0x10D3; // MEM_LOAD_UOPS_LLC_MISS_RETIRED.REMOTE_DRAM 
  
  //uint64_t events[2] = {CACHE_LLC_HITS, CACHE_LLC_MISSES};RETIRED_LOCAL_DRAM, RETIRED_REMOTE_DRAM};
  uint64_t events[2] = {RETIRED_LOCAL_DRAM, RETIRED_REMOTE_DRAM};
  //uint64_t events[4] = {CACHE_LLC_HITS, CACHE_LLC_MISSES, RETIRED_LOCAL_DRAM, RETIRED_REMOTE_DRAM};
  //uint64_t events[2] = {INSTRUCTIONS, CYCLES};

  hw_counters* counters = create_counters(pid, 2, events);
  start_counters(*counters);


read_counters(*counters, results);
    
ll_cache_read_accesses = results[0];
ll_cache_read_misses = results[1];
retired_local_dram = results[2];
    retired_remote_dram = results[3];

}

int main(int argc, char* argv[]) {

  return 0;
}

